<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cisco ISE Architecture â€“ Deep Dive</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
</head>
<body>
  <div id="wrapper">
    <div id="canvas">
      <svg id="svgLayer"></svg>
      <div id="packet"></div>
      <div id="lineTooltip"></div>
    </div>
  </div>

  <div class="ui-layer">
    <div class="left-stack">
      <div class="panel header-panel">
        <div class="header-top">
          <div>
            <div class="logo-title">
              Cisco ISE <span class="accent">Deep Dive</span>
            </div>
            <div class="logo-subtitle created-by">Created by Joshua Johnson</div>
            <div class="mini-legend">
              <span class="legend-item">
                <span class="legend-line solid"></span> Standard link
              </span>
              <span class="legend-item">
                <span class="legend-line dashed"></span> WAN / high latency
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="panel controls-panel">
        <div class="section-title">
          <span><i class="fas fa-search"></i> Find Node</span>
        </div>
        <div class="search-box">
          <input id="nodeSearch" class="search-input" type="text" placeholder="Search node..." />
          <i class="fas fa-search search-icon"></i>
        </div>

        <div style="margin-top: 15px;">
          <div class="section-title" data-target="simButtons">
            <span><i class="fas fa-project-diagram"></i> Simulations</span>
            <i class="fas fa-chevron-down toggle-icon"></i>
          </div>
          <div class="panel-content" id="simButtons"></div>
        </div>

        <div style="margin-top: 15px;" id="layerFiltersPanel"></div>
      </div>
    </div>
  </div>

  <div id="inspector">
    <div class="insp-header">
      <div>
        <div id="insp-title">Node</div>
        <div id="insp-role" class="muted"></div>
      </div>
      <button id="closeInspector" class="close-btn" aria-label="Close Inspector">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="insp-body">
      <div id="insp-content"></div>
    </div>
  </div>

  <script type="module">
    import { ArchitectureSimulator } from "./engine.js";

    async function loadConfig() {
      try {
        const files = [
          "config.meta.yaml",
          "config.topology.yaml",
          "config.connections.yaml",
          "config.simulations.yaml",
          "config.docs.yaml",
        ];

        const texts = await Promise.all(
          files.map((file) =>
            fetch(file).then((res) => {
              if (!res.ok) throw new Error(`Failed to load ${file}`);
              return res.text();
            }),
          ),
        );

        const config = texts.reduce((acc, yamlText) => {
          const part = jsyaml.load(yamlText);
          return { ...acc, ...part };
        }, {});

        // Update title/subtitle from config
        if (config.meta) {
          const t = document.getElementById("title");
          const s = document.getElementById("subtitle");
          if (t && config.meta.title) t.textContent = config.meta.title;
          if (s && config.meta.subtitle) s.textContent = config.meta.subtitle;
        }

        new ArchitectureSimulator(config);
      } catch (e) {
        console.error("Critical Error:", e);
        alert("Failed to load configuration files. See console.");
      }
    }

    window.addEventListener("DOMContentLoaded", loadConfig);
  </script>
</body>
</html>
